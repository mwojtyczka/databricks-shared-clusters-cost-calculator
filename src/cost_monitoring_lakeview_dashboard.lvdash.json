{
  "datasets": [
    {
      "name": "267e8ef8",
      "displayName": "SQL Warehouse Monitoring - Daily Cost",
      "query": "SELECT u.cost_center, u.department, m.*, w.weights\nFROM databricks_costmonitoring_poc.v1.user_costs_day m\n    INNER JOIN databricks_costmonitoring_poc.v1.user_info u ON m.user_name = u.user_name\n    LEFT JOIN (\n        SELECT \n            date_format(start_time, \"yyyy-MM-dd\") AS start_date,\n            date_format(end_time, \"yyyy-MM-dd\") AS end_date,\n            COLLECT_LIST(STRUCT(metric, weight, importance, start_time, end_time)) AS weights\n        FROM databricks_costmonitoring_poc.v1.metrics_weights\n        GROUP BY start_time, end_time\n    ) AS w ON (m.billing_date > w.start_date AND m.billing_date < w.end_date) OR (m.billing_date > w.start_date AND w.end_date IS NULL)\nWHERE m.billing_date >= '{{ start_date }}' AND m.billing_date <= '{{ end_date }}' AND m.warehouse_id = '{{ warehouse_id }}'\nORDER BY billing_date DESC"
    },
    {
      "name": "90c2c510",
      "displayName": "SQL Warehouse Monitoring - User Costs",
      "query": "SELECT\n    user_name,\n    cloud,\n    billing_year,\n    billing_month,\n    SUM(dbu) AS total_dbu,\n    SUM(dbu_euro) AS total_dbu_euro\nFROM\n    databricks_costmonitoring_poc.v1.user_costs_month\nWHERE billing_date >= '{{ start_date }}' AND billing_date <= '{{ end_date }}'\nGROUP BY\n    user_name,\n    cloud,\n    billing_year,\n    billing_month\nORDER BY\n    total_dbu_euro DESC"
    },
    {
      "name": "b2be41e5",
      "displayName": "SQL Warehouse Monitoring - Cost Center",
      "query": "SELECT u.cost_center, m.billing_date, SUM(m.dbu) as total_dbu, SUM(m.dbu_euro) as total_dbu_euro\nFROM databricks_costmonitoring_poc.v1.user_costs_month m\n    INNER JOIN databricks_costmonitoring_poc.v1.user_info u ON m.user_name = u.user_name\nWHERE m.billing_date >= '{{ start_date }}' AND m.billing_date <= '{{ end_date }}'\nGROUP BY u.cost_center, m.billing_date\nORDER BY total_dbu_euro DESC"
    },
    {
      "name": "ba5e2920",
      "displayName": "SQL Warehouse Monitoring - Department",
      "query": "SELECT u.department, m.billing_date, SUM(m.dbu) AS total_dbu, SUM(m.dbu_euro) AS total_dbu_euro\nFROM databricks_costmonitoring_poc.v1.user_costs_month m\n  INNER JOIN databricks_costmonitoring_poc.v1.user_info u ON m.user_name = u.user_name\nWHERE m.billing_date >= '{{ start_date }}' AND m.billing_date <= '{{ end_date }}'\nGROUP BY u.department, m.billing_date\nORDER BY total_dbu_euro DESC"
    },
    {
      "name": "bf520482",
      "displayName": "SQL Warehouse Monitoring - Monthly Cost",
      "query": "SELECT m.account_id, m.workspace_id, m.cloud, u.cost_center, u.department, m.user_name, m.billing_date, m.billing_year, m.billing_month, m.dbu, m.dbu_euro, m.dbu_contribution_percent\nFROM databricks_costmonitoring_poc.v1.user_costs_month m\n    INNER JOIN databricks_costmonitoring_poc.v1.user_info u ON m.user_name = u.user_name\nWHERE m.billing_date >= '{{ start_date }}' AND m.billing_date <= '{{ end_date }}'\nORDER BY billing_date DESC"
    },
    {
      "name": "d4b63c10",
      "displayName": "SQL Warehouse Monitoring - User Cost Ratio",
      "query": "WITH total_cost AS (\n    SELECT SUM(dbu_euro) AS total_dbu_euro\n    FROM databricks_costmonitoring_poc.v1.user_costs_month\n)\nSELECT\n    user_name,\n    (SUM(dbu_euro) / (SELECT total_dbu_euro FROM total_cost)) * 100 AS cost_ratio_percentage\nFROM databricks_costmonitoring_poc.v1.user_costs_month\nWHERE billing_date >= '{{ start_date }}' AND billing_date <= '{{ end_date }}'\nGROUP BY user_name;"
    }
  ],
  "pages": [
    {
      "name": "2f71f02b",
      "displayName": "New Page",
      "layout": [
        {
          "widget": {
            "name": "39151404",
            "queries": [
              {
                "name": "b7ab0fb327c4445291c7508f808bb5c1",
                "query": {
                  "datasetName": "b2be41e5",
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "Cost Center",
                "description": "",
                "viz_type": "TABLE",
                "serialized_options": "{\"itemsPerPage\":25,\"condensed\":true,\"withRowNumber\":false,\"columns\":[{\"numberFormat\":\"0\",\"booleanValues\":[\"false\",\"true\"],\"imageUrlTemplate\":\"{{ @ }}\",\"imageTitleTemplate\":\"{{ @ }}\",\"imageWidth\":\"\",\"imageHeight\":\"\",\"linkUrlTemplate\":\"{{ @ }}\",\"linkTextTemplate\":\"{{ @ }}\",\"linkTitleTemplate\":\"{{ @ }}\",\"linkOpenInNewTab\":true,\"name\":\"cost_center\",\"type\":\"integer\",\"displayAs\":\"number\",\"visible\":true,\"order\":100000,\"title\":\"cost_center\",\"allowSearch\":false,\"alignContent\":\"right\",\"allowHTML\":false,\"highlightLinks\":false,\"useMonospaceFont\":false,\"preserveWhitespace\":false},{\"dateTimeFormat\":\"YYYY-MM-DD\",\"booleanValues\":[\"false\",\"true\"],\"imageUrlTemplate\":\"{{ @ }}\",\"imageTitleTemplate\":\"{{ @ }}\",\"imageWidth\":\"\",\"imageHeight\":\"\",\"linkUrlTemplate\":\"{{ @ }}\",\"linkTextTemplate\":\"{{ @ }}\",\"linkTitleTemplate\":\"{{ @ }}\",\"linkOpenInNewTab\":true,\"name\":\"billing_date\",\"type\":\"date\",\"displayAs\":\"datetime\",\"visible\":true,\"order\":100001,\"title\":\"billing_date\",\"allowSearch\":false,\"alignContent\":\"right\",\"allowHTML\":false,\"highlightLinks\":false,\"useMonospaceFont\":false,\"preserveWhitespace\":false},{\"booleanValues\":[\"false\",\"true\"],\"imageUrlTemplate\":\"{{ @ }}\",\"imageTitleTemplate\":\"{{ @ }}\",\"imageWidth\":\"\",\"imageHeight\":\"\",\"linkUrlTemplate\":\"{{ @ }}\",\"linkTextTemplate\":\"{{ @ }}\",\"linkTitleTemplate\":\"{{ @ }}\",\"linkOpenInNewTab\":true,\"name\":\"total_dbu\",\"type\":\"decimal\",\"displayAs\":\"number\",\"visible\":true,\"order\":100002,\"title\":\"total_dbu\",\"allowSearch\":false,\"alignContent\":\"right\",\"allowHTML\":false,\"highlightLinks\":false,\"useMonospaceFont\":false,\"preserveWhitespace\":false},{\"booleanValues\":[\"false\",\"true\"],\"imageUrlTemplate\":\"{{ @ }}\",\"imageTitleTemplate\":\"{{ @ }}\",\"imageWidth\":\"\",\"imageHeight\":\"\",\"linkUrlTemplate\":\"{{ @ }}\",\"linkTextTemplate\":\"{{ @ }}\",\"linkTitleTemplate\":\"{{ @ }}\",\"linkOpenInNewTab\":true,\"name\":\"total_dbu_euro\",\"type\":\"decimal\",\"displayAs\":\"number\",\"visible\":true,\"order\":100003,\"title\":\"total_dbu_euro\",\"allowSearch\":false,\"alignContent\":\"right\",\"allowHTML\":false,\"highlightLinks\":false,\"useMonospaceFont\":false,\"preserveWhitespace\":false}],\"version\":2}",
                "query_name": "b7ab0fb327c4445291c7508f808bb5c1"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 9,
            "width": 3,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "9a5b3962",
            "queries": [
              {
                "name": "b7ab0fb327c4445291c7508f808bb5c1",
                "query": {
                  "datasetName": "b2be41e5",
                  "fields": [
                    {
                      "name": "billing_date",
                      "expression": "`billing_date`"
                    },
                    {
                      "name": "column_9c6fbf7a108",
                      "expression": "SUM(`total_dbu_euro`)"
                    },
                    {
                      "name": "cost_center",
                      "expression": "`cost_center`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "Cost Center costs",
                "description": "",
                "viz_type": "CHART",
                "serialized_options": "{\"version\":2,\"globalSeriesType\":\"column\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true},\"title\":{\"text\":\"Billing Date\"}},\"yAxis\":[{\"type\":\"-\",\"title\":{\"text\":\"Euro\"}},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_9c6fbf7a108\":{\"yAxis\":0,\"type\":\"column\"}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":false,\"dateTimeFormat\":\"YYYY-MM-DD HH:mm\",\"showDataLabels\":false,\"columnConfigurationMap\":{\"x\":{\"column\":\"billing_date\",\"id\":\"column_9c6fbf7a77\"},\"y\":[{\"id\":\"column_9c6fbf7a108\",\"column\":\"total_dbu_euro\",\"transform\":\"SUM\"}],\"series\":{\"column\":\"cost_center\",\"id\":\"column_9c6fbf7a79\"}},\"isAggregationOn\":true}",
                "query_name": "b7ab0fb327c4445291c7508f808bb5c1"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 3,
            "height": 9
          }
        },
        {
          "widget": {
            "name": "9dc8cf28",
            "queries": [
              {
                "name": "fa10fbcc506f44f097e0c1c60e9eacba",
                "query": {
                  "datasetName": "d4b63c10",
                  "fields": [
                    {
                      "name": "column_72c219f0154",
                      "expression": "SUM(`cost_ratio_percentage`)"
                    },
                    {
                      "name": "user_name",
                      "expression": "`user_name`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "User Cost Ratio",
                "description": "",
                "viz_type": "CHART",
                "serialized_options": "{\"version\":2,\"globalSeriesType\":\"pie\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true}},\"yAxis\":[{\"type\":\"-\"},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_72c219f0149\":{\"yAxis\":0,\"type\":\"pie\"},\"column_72c219f0154\":{\"yAxis\":0,\"type\":\"pie\",\"name\":\"Ratio of costs for each user\"}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":false,\"dateTimeFormat\":\"YYYY-MM-DD HH:mm\",\"showDataLabels\":true,\"columnConfigurationMap\":{\"x\":{\"column\":\"user_name\",\"id\":\"column_72c219f0156\"},\"y\":[{\"id\":\"column_72c219f0154\",\"column\":\"cost_ratio_percentage\",\"transform\":\"SUM\"}]},\"isAggregationOn\":true}",
                "query_name": "fa10fbcc506f44f097e0c1c60e9eacba"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 9,
            "width": 2,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "b90bac95",
            "queries": [
              {
                "name": "9706f0e9bdcb40688632fed0d60ea51b",
                "query": {
                  "datasetName": "267e8ef8",
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "Daily Costs",
                "description": "",
                "viz_type": "TABLE",
                "serialized_options": "{\"version\":2}",
                "query_name": "9706f0e9bdcb40688632fed0d60ea51b"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 30,
            "width": 5,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "baa9eabe",
            "queries": [
              {
                "name": "621a2ee57e3d46cc8000a494cd660580",
                "query": {
                  "datasetName": "ba5e2920",
                  "fields": [
                    {
                      "name": "billing_date",
                      "expression": "`billing_date`"
                    },
                    {
                      "name": "column_6923921120514",
                      "expression": "SUM(`total_dbu_euro`)"
                    },
                    {
                      "name": "department",
                      "expression": "`department`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "Department costs",
                "description": "",
                "viz_type": "CHART",
                "serialized_options": "{\"version\":2,\"globalSeriesType\":\"column\",\"sortX\":true,\"sortY\":true,\"legend\":{\"traceorder\":\"normal\"},\"xAxis\":{\"type\":\"-\",\"labels\":{\"enabled\":true},\"title\":{\"text\":\"Billing Date\"}},\"yAxis\":[{\"type\":\"-\",\"title\":{\"text\":\"Euro\"}},{\"type\":\"-\",\"opposite\":true}],\"alignYAxesAtZero\":true,\"error_y\":{\"type\":\"data\",\"visible\":true},\"series\":{\"stacking\":null,\"error_y\":{\"type\":\"data\",\"visible\":true}},\"seriesOptions\":{\"column_6923921120514\":{\"yAxis\":0,\"type\":\"column\"}},\"valuesOptions\":{},\"direction\":{\"type\":\"counterclockwise\"},\"sizemode\":\"diameter\",\"coefficient\":1,\"numberFormat\":\"0,0.[00000]\",\"percentFormat\":\"0[.]00%\",\"textFormat\":\"\",\"missingValuesAsZero\":true,\"useAggregationsUi\":true,\"swappedAxes\":false,\"dateTimeFormat\":\"YYYY-MM-DD HH:mm\",\"showDataLabels\":false,\"columnConfigurationMap\":{\"x\":{\"column\":\"billing_date\",\"id\":\"column_6923921120510\"},\"y\":[{\"id\":\"column_6923921120514\",\"column\":\"total_dbu_euro\",\"transform\":\"SUM\"}],\"series\":{\"column\":\"department\",\"id\":\"column_6923921120512\"}},\"isAggregationOn\":true,\"condensed\":true,\"withRowNumber\":true}",
                "query_name": "621a2ee57e3d46cc8000a494cd660580"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 0,
            "width": 2,
            "height": 9
          }
        },
        {
          "widget": {
            "name": "dc6e90ea",
            "queries": [
              {
                "name": "6c6e52f34502458c98b7c1ce75b526ff",
                "query": {
                  "datasetName": "90c2c510",
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "User costs",
                "description": "",
                "viz_type": "TABLE",
                "serialized_options": "{\"version\": 2}",
                "query_name": "6c6e52f34502458c98b7c1ce75b526ff"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 16,
            "width": 5,
            "height": 8
          }
        },
        {
          "widget": {
            "name": "dca9855d",
            "queries": [
              {
                "name": "401c7764db5145e094fb948bbf1b9797",
                "query": {
                  "datasetName": "bf520482",
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 0,
              "viz_spec": {
                "display_name": "Monthly Costs",
                "description": "",
                "viz_type": "TABLE",
                "serialized_options": "{\"version\": 2}",
                "query_name": "401c7764db5145e094fb948bbf1b9797"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 24,
            "width": 5,
            "height": 6
          }
        }
      ]
    }
  ]
}