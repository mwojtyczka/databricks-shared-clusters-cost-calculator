{"datasets":[{"name":"18d7ad8d","displayName":"cost_agg_day","query":"SELECT \n    u.department, \n    u.cost_center, \n    c.billing_date, \n    date(date_format(c.billing_date,\"yyyy-MM\")) AS month, \n    SUM(dbu_cost) AS total_cost, \n    c.account_id, \n    c.warehouse_id, \n    c.workspace_id, \n    c.cloud, \n    c.user_name\nFROM main.billing_granular_clusters_cost.cost_agg_day AS c\nINNER JOIN main.billing_granular_clusters_cost.user_info AS u ON u.user_name = c.user_name\nGROUP BY \n    u.department, \n    u.cost_center, \n    c.billing_date, \n    c.account_id, \n    c.warehouse_id, \n    c.workspace_id, \n    c.cloud, \n    c.user_name"},{"name":"adc96195","displayName":"departments_budget","query":"SELECT * EXCEPT (b.department, b.weekly_budget), \n    CASE WHEN total_cost - monthly_budget > 0 \n        THEN total_cost - monthly_budget \n        ELSE null \n    END AS budget_excess \nFROM (\n    SELECT department, \n        date(date_format(c.billing_date,\"yyyy-MM\")) AS month, \n        sum(dbu_cost) AS total_cost \n    FROM main.billing_granular_clusters_cost.cost_agg_day AS c\n    INNER JOIN main.billing_granular_clusters_cost.user_info AS u ON u.user_name = c.user_name\n    GROUP BY u.department, date_format(c.billing_date,\"yyyy-MM\")\n) a \nLEFT JOIN main.billing_granular_clusters_cost.budgets b ON a.department = b.department"}],"pages":[{"name":"b90bd79a","displayName":"New Page","layout":[{"widget":{"name":"28e3322a","textbox_spec":"# Granular Cost Allocation for Shared Clusters\n\nThis dashboard allocates usage of “Shared” SQL Warehouses to individual users and their respective organisational entities (eg. cost center, business unit).   "},"position":{"x":0,"y":0,"width":6,"height":2}},{"widget":{"name":"70ee9e4e","queries":[{"name":"main_query","query":{"datasetName":"18d7ad8d","fields":[{"name":"sum(total_cost)","expression":"SUM(`total_cost`)"},{"name":"monthly(billing_date)","expression":"DATE_TRUNC(\"MONTH\", `billing_date`)"},{"name":"department","expression":"`department`"},{"name":"cost_center","expression":"`cost_center`"},{"name":"user_name","expression":"`user_name`"}],"disaggregated":false,"orders":[{"direction":"ASC","expression":"`department`"},{"direction":"ASC","expression":"`cost_center`"},{"direction":"ASC","expression":"`user_name`"},{"direction":"ASC","expression":"DATE_TRUNC(\"MONTH\", `billing_date`)"}]}}],"spec":{"version":3,"widgetType":"pivot","encodings":{"rows":[{"fieldName":"department","displayName":"Department"},{"fieldName":"cost_center","displayName":"Cost center"},{"fieldName":"user_name","displayName":"User"}],"columns":[{"fieldName":"monthly(billing_date)","displayName":"date"}],"cell":{"type":"multi-cell","fields":[{"fieldName":"sum(total_cost)","cellType":"text","displayName":"cost [$]"}]}},"frame":{"showTitle":true,"title":"Total cost breakdown over billing period"}}},"position":{"x":0,"y":16,"width":6,"height":4}},{"widget":{"name":"aa3ceb97","queries":[{"name":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_cost_center","query":{"datasetName":"18d7ad8d","fields":[{"name":"cost_center","expression":"`cost_center`"},{"name":"cost_center_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"cost_center","displayName":"cost_center","queryName":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_cost_center"}]},"frame":{"showTitle":true,"title":"Cost Center"}}},"position":{"x":1,"y":2,"width":1,"height":2}},{"widget":{"name":"5f728ab8","queries":[{"name":"dashboards/01ef4040f8591888ba15c3793a86b5b8/datasets/01ef4040f87918a3b1699d025028686c_department","query":{"datasetName":"18d7ad8d","fields":[{"name":"department","expression":"`department`"},{"name":"department_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"fieldName":"department","displayName":"department","queryName":"dashboards/01ef4040f8591888ba15c3793a86b5b8/datasets/01ef4040f87918a3b1699d025028686c_department"}]},"frame":{"showTitle":true,"title":"Department"}}},"position":{"x":0,"y":2,"width":1,"height":2}},{"widget":{"name":"650f3c26","queries":[{"name":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_user_name","query":{"datasetName":"18d7ad8d","fields":[{"name":"user_name","expression":"`user_name`"},{"name":"user_name_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"fieldName":"user_name","displayName":"user_name","queryName":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_user_name"}]},"frame":{"showTitle":true,"title":"User"}}},"position":{"x":2,"y":2,"width":1,"height":2}},{"widget":{"name":"54fa5e41","queries":[{"name":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_billing_date","query":{"datasetName":"18d7ad8d","fields":[{"name":"billing_date","expression":"`billing_date`"},{"name":"billing_date_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-range-picker","encodings":{"fields":[{"fieldName":"billing_date","displayName":"billing_date","queryName":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_billing_date"}]},"frame":{"showTitle":true,"title":"Date range"}}},"position":{"x":5,"y":2,"width":1,"height":2}},{"widget":{"name":"31a9b168","queries":[{"name":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_cloud","query":{"datasetName":"18d7ad8d","fields":[{"name":"cloud","expression":"`cloud`"},{"name":"cloud_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"fieldName":"cloud","displayName":"cloud","queryName":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_cloud"}]},"frame":{"showTitle":true,"title":"Cloud"}}},"position":{"x":3,"y":2,"width":1,"height":2}},{"widget":{"name":"3fe3d845","queries":[{"name":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_warehouse_id","query":{"datasetName":"18d7ad8d","fields":[{"name":"warehouse_id","expression":"`warehouse_id`"},{"name":"warehouse_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"fieldName":"warehouse_id","displayName":"warehouse_id","queryName":"dashboards/01ef3f76c825191d9c9a02e43d33a64e/datasets/01ef3f76c82a1107a553d0f8b2038744_warehouse_id"}]},"frame":{"showTitle":true,"title":"Warehouse (ID)"}}},"position":{"x":4,"y":2,"width":1,"height":2}},{"widget":{"name":"c7a97432","queries":[{"name":"main_query","query":{"datasetName":"18d7ad8d","fields":[{"name":"user_name","expression":"`user_name`"},{"name":"monthly(billing_date)","expression":"DATE_TRUNC(\"MONTH\", `billing_date`)"},{"name":"sum(total_cost)","expression":"SUM(`total_cost`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"monthly(billing_date)","scale":{"type":"temporal"},"displayName":"date"},"y":{"fieldName":"sum(total_cost)","scale":{"type":"quantitative"},"displayName":"cost [$]"},"color":{"fieldName":"user_name","scale":{"type":"categorical"},"displayName":"User"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Total monthly cost by user"}}},"position":{"x":2,"y":4,"width":2,"height":6}},{"widget":{"name":"6d962aea","queries":[{"name":"main_query","query":{"datasetName":"18d7ad8d","fields":[{"name":"department","expression":"`department`"},{"name":"monthly(billing_date)","expression":"DATE_TRUNC(\"MONTH\", `billing_date`)"},{"name":"sum(total_cost)","expression":"SUM(`total_cost`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"monthly(billing_date)","scale":{"type":"temporal"},"displayName":"date"},"y":{"fieldName":"sum(total_cost)","scale":{"type":"quantitative"},"displayName":"cost [$]"},"color":{"fieldName":"department","scale":{"type":"categorical"},"displayName":"department"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Total monthly cost by department"}}},"position":{"x":0,"y":4,"width":2,"height":6}},{"widget":{"name":"ed27c0ac","queries":[{"name":"main_query","query":{"datasetName":"18d7ad8d","fields":[{"name":"sum(total_cost)","expression":"SUM(`total_cost`)"},{"name":"cloud","expression":"`cloud`"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"pie","encodings":{"angle":{"fieldName":"sum(total_cost)","scale":{"type":"quantitative"},"displayName":"cost [$]"},"color":{"fieldName":"cloud","scale":{"type":"categorical"},"displayName":"cloud"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Cloud distribution"}}},"position":{"x":4,"y":6,"width":2,"height":4}},{"widget":{"name":"b5af5335","queries":[{"name":"main_query","query":{"datasetName":"18d7ad8d","fields":[{"name":"sum(total_cost)","expression":"SUM(`total_cost`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"sum(total_cost)","displayName":"Sum of total_cost"}},"frame":{"showTitle":true,"title":"Total cost"}}},"position":{"x":4,"y":4,"width":1,"height":2}},{"widget":{"name":"01006593","queries":[{"name":"main_query","query":{"datasetName":"18d7ad8d","fields":[{"name":"countdistinct(user_name)","expression":"COUNT(DISTINCT `user_name`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"countdistinct(user_name)","displayName":"Count of Unique user_name"}},"frame":{"showTitle":true,"title":"Users"}}},"position":{"x":5,"y":4,"width":1,"height":2}},{"widget":{"name":"a7e56a8f","textbox_spec":"## Further in depth analysis\nLet's have a closer look at departments that exceeded their budgets and potentials"},"position":{"x":0,"y":10,"width":6,"height":2}},{"widget":{"name":"31a98d6e","queries":[{"name":"main_query","query":{"datasetName":"adc96195","fields":[{"name":"sum(budget_excess)","expression":"SUM(`budget_excess`)"},{"name":"monthly(month)","expression":"DATE_TRUNC(\"MONTH\", `month`)"},{"name":"department","expression":"`department`"}],"disaggregated":false,"orders":[{"direction":"ASC","expression":"`department`"},{"direction":"ASC","expression":"DATE_TRUNC(\"MONTH\", `month`)"}]}}],"spec":{"version":3,"widgetType":"pivot","encodings":{"rows":[{"fieldName":"department","displayName":"department"}],"columns":[{"fieldName":"monthly(month)","displayName":"month"}],"cell":{"type":"multi-cell","fields":[{"fieldName":"sum(budget_excess)","cellType":"text","displayName":"budget excess"}]}}}},"position":{"x":0,"y":12,"width":6,"height":4}}]}]}